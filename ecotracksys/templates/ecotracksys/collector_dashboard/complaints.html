{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Collector Complaints â€” EcoTrack</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    /* Theme variables */
    :root{
      --bg:#f6fff9;
      --mint-600:#2e7d32;
      --mint-500:#43a047;
      --mint-300:#a5d6a7;
      --accent:#20c997;
      --card:#ffffff;
      --muted:#6b6b6b;
      --warning:#f0ad4e;
      --danger:#e53935;
      --shadow:0 6px 22px rgba(16,64,54,0.08);
    }

    html, body {
      height: 100%;
      margin: 0;
    }

    body {
      display: flex;
      font-family: Inter, system-ui;
      background: var(--bg);
      color: #0b3d2e;
    }

    .app {
      display: flex;
      min-height: 100vh;
      width: 100%;
      gap: 20px;
    }

    /* Sidebar */
    .sidebar {
      width: 240px;
      background: linear-gradient(180deg,var(--mint-300),#e6f7ec);
      padding: 18px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
    }

    .brand {
      font-weight:700;
      color:var(--mint-600);
      font-size:1.15rem;
      text-align:center;
      margin-bottom:14px;
    }

    .nav {
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:6px;
      flex-grow: 1;
    }

    .nav a {
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      color:var(--mint-600);
      border-radius:10px;
      font-weight:600;
      text-decoration:none;
    }

    .nav a:hover, .nav a.active {
      background:var(--mint-500);
      color:#fff;
    }

    /* Main area */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 18px;
      padding: 30px;
      min-height: 100vh;
    }

    .topbar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:#fff;
      padding:12px 18px;
      border-radius:12px;
      box-shadow:var(--shadow);
    }

    /* Avatar dropdown */
    .avatar-dropdown {
      position: relative;
      display: inline-block;
    }

    .avatar-dropdown button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
    }

    .profile-image {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--mint-500);
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      right: 0;
      top: 50px;
      background: var(--card);
      border-radius: 10px;
      box-shadow: var(--shadow);
      min-width: 160px;
      overflow: hidden;
      z-index: 10;
    }

    .dropdown-menu a {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      color: var(--mint-600);
      text-decoration: none;
      font-weight: 600;
    }

    .dropdown-menu a:hover {
      background: var(--mint-500);
      color: #fff;
    }

    .card {
      background: var(--card);
      padding: 18px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    h3 { margin-top:0; color: var(--mint-600); }

    table {
      width:100%;
      border-collapse:collapse;
      margin-top:12px;
    }
    th, td {
      padding:10px;
      border-bottom:1px solid #f0f0f0;
      text-align:left;
    }
    th { background:#f6fff9; color: var(--mint-600); }

    .status {
      padding:4px 10px;
      border-radius:999px;
      font-size:0.85rem;
      font-weight:600;
    }
    .pending { background:#fff9e6; color:#8a6b00; }
    .review { background:#e6f4ff; color:#055a66; }
    .resolved { background:#e6fbef; color:#0b6b3d; }
  </style>
</head>
<body>
<div class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="brand">EcoTrack</div>
    <ul class="nav">
      <li><a href="{% url 'ecotracksys:collector_assignments' %}"><span class="icon"><i class="fas fa-list-check"></i></span><span class="label">My Assignments</span></a></li>
      <li><a href="{% url 'ecotracksys:collector_pickup_history' %}"><span class="icon"><i class="fas fa-clock-rotate-left"></i></span><span class="label">History</span></a></li>
      <li><a href="{% url 'ecotracksys:collector_performance' %}"><span class="icon"><i class="fas fa-chart-line"></i></span><span class="label">Performance</span></a></li>
      <li><a href="{% url 'ecotracksys:collector_leave' %}"><span class="icon"><i class="fas fa-calendar-alt"></i></span><span class="label">Leave</span></a></li>
      <li><a href="{% url 'ecotracksys:collector_notifications' %}"><span class="icon"><i class="fas fa-bell"></i></span><span class="label">Notifications</span></a></li>
      <li><a href="{% url 'ecotracksys:collector_complaints' %}" class="active"><span class="icon"><i class="fas fa-cog"></i></span><span class="label">Complaints</span></a></li>
      <li><a href="{% url 'ecotracksys:collector_profile' %}"><span class="icon"><i class="fas fa-user"></i></span><span class="label">Profile</span></a></li>
    </ul>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div class="topbar">
      <h2>Complaints</h2>
      <div class="avatar-dropdown">
        <button id="avatarBtn">
          {% if request.user.profile_image %}
            <img src="{{ request.user.profile_image.url }}" alt="Profile Image" class="profile-image">
          {% else %}
            <img src="{% static 'default_profile.png' %}" alt="Profile Image" class="profile-image">
          {% endif %}
        </button>
        <div class="dropdown-menu" id="avatarMenu">
          <a href="{% url 'ecotracksys:collector_profile' %}"><i class="fas fa-user"></i> View Profile</a>
          <a href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
      </div>
    </div>

    <!-- Complaint History -->
    <section class="card">
      <h3>My Complaints</h3>
      <table>
        <thead>
          <tr>
            <th>ID</th><th>Subject</th><th>Type</th><th>Status</th><th>Date</th>
          </tr>
        </thead>
        <tbody>
          {% for c in complaints %}
          <tr>
            <td>{{ c.id }}</td>
            <td>{{ c.subject }}</td>
            <td>{{ c.complaint_type|title }}</td>
            <td>
              {% if c.status == "pending" %}
                <span class="status pending">Pending</span>
              {% elif c.status == "review" %}
                <span class="status review">In Review</span>
              {% elif c.status == "resolved" %}
                <span class="status resolved">Resolved</span>
              {% else %}
                <span class="status">{{ c.status }}</span>
              {% endif %}
            </td>
            <td>{{ c.created_at|date:"Y-m-d" }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="5" style="text-align:center;color:var(--muted)">No complaints submitted yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
  </main>
</div>

<script>
  const avatarBtn = document.getElementById('avatarBtn');
  const avatarMenu = document.getElementById('avatarMenu');

  avatarBtn.addEventListener('click', () => {
    avatarMenu.style.display = avatarMenu.style.display === 'block' ? 'none' : 'block';
  });

  window.addEventListener('click', function(e) {
    if (!avatarBtn.contains(e.target) && !avatarMenu.contains(e.target)) {
      avatarMenu.style.display = 'none';
    }
  });
</script>
</body>
</html>
