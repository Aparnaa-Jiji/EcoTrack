{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Pickup History â€” EcoTrack</title>

  <!-- FontAwesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root{
      --bg:#f6fff9;
      --mint-600:#2e7d32;
      --mint-500:#43a047;
      --mint-300:#a5d6a7;
      --accent:#20c997;
      --card:#ffffff;
      --muted:#6b6b6b;
      --success:#2e7d32;
      --warning:#f0ad4e;
      --danger:#e53935;
      --shadow:0 6px 22px rgba(16,64,54,0.08);
    }

    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif; background:linear-gradient(135deg,var(--bg),#e8faf0 60%);}

    .app{display:flex;min-height:100vh;gap:20px;}

    /* Sidebar */
    .sidebar{width:240px;background:linear-gradient(180deg,var(--mint-300), #e6f7ec);padding:18px;box-shadow:var(--shadow);}
    .brand{font-weight:700;color:var(--mint-600);font-size:1.15rem;text-align:center;margin-bottom:14px;}
    .nav{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:6px;}
    .nav a{display:flex;align-items:center;gap:10px;padding:10px 12px;text-decoration:none;color:var(--mint-600);border-radius:10px;font-weight:600;}
    .nav a.active, .nav a:hover{background:var(--mint-500);color:#fff;transform:translateX(4px);}
    .nav a.active .icon{color:#fff;}
    .icon{width:28px;text-align:center;}

    /* Main */
    .main{flex:1;display:flex;flex-direction:column;gap:18px;padding:22px;}

    /* Topbar */
    .topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;background:rgba(255,255,255,0.85);border-radius:12px;box-shadow:var(--shadow);position:sticky;top:18px;z-index:10;}
    .topbar h2{margin:0;color:var(--mint-600);font-size:1.25rem;}
    
    .profile{position:relative;display:flex;align-items:center;gap:10px;}
    .avatar{width:40px;height:40px;border-radius:50%;border:2px solid var(--mint-500);overflow:hidden;cursor:pointer;}
    .avatar img{width:100%;height:100%;object-fit:cover;}
    .profile .menu{display:none;position:absolute;right:0;top:54px;background:#fff;border-radius:10px;box-shadow:var(--shadow);min-width:180px;}
    .profile.open .menu{display:block;}
    .profile .menu a{display:block;padding:10px 12px;text-decoration:none;color:#0b3d2e;font-weight:600;}
    .profile .menu a:hover{background:#f3fff7;}

    /* Filter bar */
    .filter-bar{display:flex;justify-content:flex-end;margin:12px 0;}
    .filter-bar select{padding:8px 12px;border:1px solid #e0eee4;border-radius:8px;background:#fff;color:var(--mint-600);font-weight:600;}

    /* Table */
    table{width:100%;border-collapse:collapse;background:var(--card);box-shadow:var(--shadow);border-radius:12px;overflow:hidden;}
    thead{background:var(--mint-500);color:#fff;}
    th,td{padding:12px;text-align:left;}
    tbody tr:nth-child(even){background:#f6fff9;}
    tbody tr{cursor:pointer;transition:background .2s;}
    tbody tr:hover{background:#e6f7ec;}

    /* Status badges */
    .status{font-weight:700;padding:6px 10px;border-radius:999px;font-size:0.85rem;}
    .Completed{background:#e6fbef;color:var(--success);}
    .Pending{background:#fff9e6;color:#8a6b00;}
    .Missed{background:#fff0f0;color:var(--danger);}

    /* Modal */
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4);justify-content:center;align-items:center;z-index:1000;}
    .modal-content{background:var(--card);padding:22px;border-radius:12px;box-shadow:var(--shadow);width:90%;max-width:420px;position:relative;}
    .modal-content h3{margin-top:0;color:var(--mint-600);}
    .modal-content p{margin:8px 0;}
    .close{position:absolute;right:16px;top:12px;font-size:20px;cursor:pointer;color:var(--muted);}

    @media(max-width:880px){.sidebar{display:none}.main{padding:12px}}
  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">EcoTrack</div>
      <ul class="nav">
        <li><a href="{% url 'ecotracksys:collector_dashboard' %}"><span class="icon"><i class="fas fa-home"></i></span>Dashboard</a></li>
        <li><a href="{% url 'ecotracksys:collector_assignments' %}"><span class="icon"><i class="fas fa-list-check"></i></span>My Assignments</a></li>
        <li><a href="{% url 'ecotracksys:collector_pickup_history' %}" class="active"><span class="icon"><i class="fas fa-clock-rotate-left"></i></span>History</a></li>
        <li><a href="{% url 'ecotracksys:collector_performance' %}"><span class="icon"><i class="fas fa-chart-line"></i></span>Performance</a></li>
        <li><a href="{% url 'ecotracksys:collector_leave' %}"><span class="icon"><i class="fas fa-calendar-alt"></i></span>Leave</a></li>
        <li><a href="{% url 'ecotracksys:collector_notifications' %}"><span class="icon"><i class="fas fa-bell"></i></span>Notifications</a></li>
        <li><a href="{% url 'ecotracksys:collector_complaints' %}"><span class="icon"><i class="fas fa-cog"></i></span>Complaints</a></li>
        <li><a href="{% url 'ecotracksys:collector_profile' %}"><span class="icon"><i class="fas fa-user"></i></span>Profile</a></li>
      </ul>
    </aside>

    <!-- Main -->
    <main class="main">
      <!-- Topbar -->
      <div class="topbar">
        <h2><i class="fas fa-clock-rotate-left"></i> Pickup History</h2>
        <div class="profile" id="profile">
          <div class="avatar" id="avatarBtn" tabindex="0">
          {% if request.user.profile_image %}
            <img src="{{ request.user.profile_image.url }}" alt="Profile Image" class="profile-image">
          {% else %}
            <img src="{% static 'images/default_profile.png' %}" alt="Profile Image" class="profile-image">
          {% endif %}
          </div>
          <div class="menu" role="menu">
            <a href="{% url 'ecotracksys:collector_profile' %}">ðŸ‘¤ View profile</a>
            <a href="{% url 'logout' %}">ðŸšª Logout</a>
          </div>
        </div>
      </div>

      <!-- Filter Bar -->
      <div class="filter-bar">
        <select id="statusFilter">
          <option value="All">All</option>
          <option value="Completed">Completed</option>
          <option value="Pending">Pending</option>
          <option value="Missed">Missed</option>
        </select>
      </div>

      <!-- Table -->
      <table id="pickupTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Date</th>
            <th>Citizen</th>
            <th>Zone</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for pickup in pickups %}
          <tr data-status="{{ pickup.status }}" data-time="{{ pickup.pickup_time }}" data-waste="{{ pickup.waste_type }}" data-phone="{{ pickup.user.phone }}" data-notes="{{ pickup.notes }}">
            <td>{{ pickup.id }}</td>
            <td>{{ pickup.pickup_date }}</td>
            <td>{{ pickup.user.get_full_name }}</td>
            <td>{{ pickup.zone }}</td>
            <td><span class="status {{ pickup.status }}">{{ pickup.status }}</span></td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" style="text-align:center;color:var(--muted)">No pickup history found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </main>
  </div>

  <!-- Modal -->
  <div class="modal" id="detailModal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h3>Pickup Details</h3>
      <p><strong>ID:</strong> <span id="modalId"></span></p>
      <p><strong>Date:</strong> <span id="modalDate"></span></p>
      <p><strong>Time:</strong> <span id="modalTime"></span></p>
      <p><strong>Citizen:</strong> <span id="modalCitizen"></span></p>
      <p><strong>Phone:</strong> <span id="modalPhone"></span></p>
      <p><strong>Zone:</strong> <span id="modalZone"></span></p>
      <p><strong>Waste Type:</strong> <span id="modalWaste"></span></p>
      <p><strong>Notes:</strong> <span id="modalNotes"></span></p>
      <p><strong>Status:</strong> <span id="modalStatus"></span></p>
    </div>
  </div>

  <script>
    // Profile dropdown
    const avatarBtn=document.getElementById('avatarBtn');
    const profile=document.getElementById('profile');
    avatarBtn.addEventListener('click',()=>profile.classList.toggle('open'));
    document.addEventListener('click',e=>{if(!profile.contains(e.target)) profile.classList.remove('open');});

    // Table row click to show modal
    const rows=document.querySelectorAll('#pickupTable tbody tr');
    const modal=document.getElementById('detailModal');
    rows.forEach(row=>{
      row.addEventListener('click',()=>{
        document.getElementById('modalId').innerText=row.cells[0].innerText;
        document.getElementById('modalDate').innerText=row.cells[1].innerText;
        document.getElementById('modalCitizen').innerText=row.cells[2].innerText;
        document.getElementById('modalZone').innerText=row.cells[3].innerText;
        document.getElementById('modalStatus').innerText=row.querySelector('.status').innerText;
        document.getElementById('modalTime').innerText=row.dataset.time;
        document.getElementById('modalWaste').innerText=row.dataset.waste;
        document.getElementById('modalPhone').innerText=row.dataset.phone;
        document.getElementById('modalNotes').innerText=row.dataset.notes;
        modal.style.display='flex';
      });
    });
    function closeModal(){modal.style.display='none';}

    // Status filter
    document.getElementById('statusFilter').addEventListener('change',function(){
      const val=this.value;
      rows.forEach(row=>{row.style.display=(val==='All'||row.dataset.status===val)?'':'none';});
    });
  </script>
</body>
</html>
