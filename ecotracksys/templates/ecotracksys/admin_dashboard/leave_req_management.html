{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Page metadata and responsive settings -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Leave Request Management â€“ EcoTrack</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <!-- Bootstrap icons for UI buttons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    /* ================================
       COLOR VARIABLES (EASY TO EDIT)
    ================================== */
    :root {
     --bg-image: url("{% static 'images/bgimg.jpg' %}");
  background: linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(103, 206, 168, 0.7));
  --container-gradient: linear-gradient(145deg, rgba(4, 57, 39, 0.9), rgba(5, 111, 79, 0.85));
  --primary: #04706e;       /* main accent */
  --secondary: #2f9080;   /* headers / highlights */
  --highlight: #85fcde;     /* minty highlight */
  --shadow: rgba(3, 104, 77, 0.5); /* shadow for depth */
  --text-light: #e6fef3;    /* light text */
  --text-dark: #0b3d2e;    /* dark text */
    }

    /* ================================
       PAGE BASE STYLES
    ================================== */
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg-image);
      color: var(--text-dark);
    }

    .container { 
      display: flex; 
      min-height: 100vh; 
      background: linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(103, 206, 168, 0.7));
    }

    /* ================================
       STATUS BADGES
    ================================== */
    .status-badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
      display: inline-block;
      min-width: 70px;
      text-align: center;
    }
    .status-pending { background-color: orange; color: #fff; }
    .status-approved { background-color: limegreen; color: #fff; }
    .status-rejected { background-color: #ff5252; color: #fff; }

    /* ================================
       SIDEBAR NAVIGATION
    ================================== */
    .sidebar {
      width: 260px;
      background: linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(103, 206, 168, 0.7));
      transition: width 0.3s ease, padding 0.3s ease; /* Smooth collapse animation */

      box-shadow: 2px 0 12px var(--shadow);
      backdrop-filter: blur(12px);
    }
    .sidebar.collapsed { width: 70px; padding: 0px; }
    .sidebar h2 {
      text-align: center;
      padding: 20px 0;
      font-size: 1.6rem;
      margin: 0;
      color: var(--primary);
    }
    .sidebar.collapsed h2 { opacity: 0; }
    .sidebar ul { list-style: none; padding: 0; margin: 0; }
    .sidebar ul li a {
      display: flex;
      align-items: center;
      gap: 12px; /* Space between icon and text */
      padding: 14px 22px;
      color: var(--text-dark);
      text-decoration: none;
      border-radius: 8px;
      transition: background 0.3s ease;
    }
    .sidebar ul li a:hover {
  background: var(--secondary);
  color: #ffffff; /* make text/icons white when hovered */
}
/* Active link style */
.sidebar ul li a.active {
  background: var(--primary);
  color: #ffffff;
  font-weight: bold;
}

    .sidebar ul li i { font-size: 18px; }
    .sidebar ul li a {
      display: flex;
      align-items: center;
      gap: 12px; /* Space between icon and text */
      padding: 14px 22px;
      color: var(--text-dark);
      text-decoration: none;
      border-radius: 8px;
      transition: background 0.3s ease;
    }
    .sidebar ul li span { transition: opacity 0.3s ease; }
    .sidebar.collapsed ul li span { opacity: 0; }
    .toggle-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: none;
      border: none;
      font-size: 22px;
      color: var(--text-dark);
      cursor: pointer;
    }

    /* ================================
       MAIN CONTENT
    ================================== */
    .main { flex: 1; padding: 24px; }
    .header { 
      font-size: 26px;
      font-weight: bold;
      color: var(--primary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    .header h1 { font-size: 26px; }

    /* ================================
       TABLE STYLING
    ================================== */
    table {
      width: 100%;
  border-collapse: collapse;
  background: var(--primary); 
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 12px var(--shadow);
    }
    th, td {
      padding: 16px;
  text-align: left;
  border-bottom: 1px solid rgba(3, 104, 77, 0.2);
    }
    th { 
      background: var(--primary);  /* green header */
  color: white;       /* table header text */ 
    }
    tr:hover { 
      background-color: rgba(4, 112, 110, 0.08); 
    }

    /* Table action buttons */
    .actions { display: flex; gap: 10px; }
    .action-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      color: var(--light-blue);
      transition: all 0.2s ease-in-out;
    }
    .action-btn:hover { color: var(--highlight); transform: scale(1.1); }

    /* ================================
       MODAL STYLING
    ================================== */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(15,32,39,0.9);
      backdrop-filter: blur(5px);
    }
    .modal-content {
      background: #1c2b4a;
      margin: 8% auto;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 4px 12px var(--shadow);
      color: var(--text-light);
      position: relative;
    }
    .close-btn {
      position: absolute;
      top: 12px; right: 16px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      color: var(--highlight);
      transition: color 0.3s ease;
    }
    .close-btn:hover { color: var(--light-blue); }
    .modal-content h2 { margin-top: 0; color: var(--highlight); }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; margin-bottom: 6px; color: var(--light-blue); }
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: none;
      background-color: #273b61;
      color: var(--text-light);
    }
    .submit-btn {
      padding: 10px 18px;
      background-color: var(--primary);
      border: none;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s ease;
    }
    .submit-btn:hover { background-color: var(--secondary); }

    /* Responsive design for small screens */
    @media screen and (max-width: 768px) {
      .sidebar { position: fixed; z-index: 999; height: 100%; }
      .main { margin-left: 70px; }
    }

    /* Profile box */
    .profile-box {
      flex: 1 1 300px;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(10px);
      padding:20px;
      border-radius:16px;
      box-shadow:0 4px 20px var(--shadow);
      color: #0b3d2e;
    }

    .profile-menu {
  position: absolute;
  top: 16px;
  right: 30px;
}
/* Profile Image */
.profile-img {
  width: 50px;
  height: 50px;     /* make width and height equal */
  border-radius: 50%;
  object-fit: cover; /* fill the circle without distortion */
  border: 2px solid var(--primary);
  cursor: pointer;
  display: block;
}


/* Dropdown Menu */
.profile-dropdown {
  display: none;
  position: absolute;
  right: 0;
  top: 55px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 15px var(--shadow);
  overflow: hidden;
  z-index: 1000;
  min-width: 150px;
}
/* Dropdown Links */
.profile-dropdown a {
  display: block;
  padding: 10px 14px;
  text-decoration: none;
  color: var(--text-dark);
  font-size: 14px;
  transition: background 0.2s;
}

.profile-dropdown a:hover {
  background: var(--secondary);
}
  </style>
</head>

<body>
  <div class="container">
    <!-- ================================
         SIDEBAR MENU
    ================================== -->
    <div class="sidebar" id="sidebar">
      <button class="toggle-btn" onclick="toggleSidebar()"><i class="bi bi-list"></i></button>
      <h2>EcoTrack</h2>
      <ul>
      
         <li><a href="{% url 'ecotracksys:admin_dashboard' %}" ><i class="fas fa-home"></i> <span>Dashboard</span></a></li>
  <li><a href="{% url 'ecotracksys:pickup_management' %}" ><i class="fas fa-trash"></i> <span>Pickup Management</span></a></li>
  <li><a href="{% url 'ecotracksys:zone_management' %}"><i class="fas fa-map-marker-alt"></i> <span>Zone Management</span></a></li>
  <li><a href="{% url 'ecotracksys:leave_request_management' %}" class="active"><i class="fas fa-calendar-alt"></i> <span>Leave Requests</span></a></li>
  <li><a href="{% url 'ecotracksys:complaint_management' %}"><i class="fas fa-bullhorn"></i> <span>Complaints</span></a></li>
  <li><a href="{% url 'ecotracksys:user_management' %}"><i class="fas fa-users"></i> <span>User Management</span></a></li>
  <li><a href="{% url 'ecotracksys:collector_management' %}"><i class="fas fa-user-cog"></i> <span>Collector Management</span></a></li>
  <li><a href="{% url 'ecotracksys:analytics' %}"><i class="fas fa-chart-line"></i> <span>Analytics</span></a></li>
  <li><a href="{% url 'ecotracksys:admin_profile' %}"><i class="fas fa-user-shield"></i> <span>Admin Profile</span></a></li>
 </ul>
    </div>

    <!-- ================================
         MAIN CONTENT AREA
    ================================== -->
    <div class="main">
                  <!-- Profile Image Dropdown -->
<div class="profile-menu">
        {% if user.is_authenticated %}
          {% if request.user.profile_image %}
            <img src="{{ request.user.profile_image.url }}" alt="Profile Image" class="profile-img" onclick="toggleProfileMenu()">
          {% else %}
            <img src="{% static 'default_profile.png' %}" alt="Profile Image" class="profile-img" onclick="toggleProfileMenu()">
          {% endif %}
        {% endif %}



  <!-- Dropdown Menu -->
  <div class="profile-dropdown" id="profileDropdown">
    <a href="{% url 'ecotracksys:admin_profile' %}">ðŸ‘¤ View Profile</a>
    <a href="{% url 'logout' %}">ðŸšª Logout</a>
  </div>
</div>
      <div class="header">
        <h1>Collector Leave Requests</h1>
      </div>

      <!-- Leave Requests Table -->
      <table>
        <thead>
          <tr>
            <th>Collector</th>
            <th>From</th>
            <th>To</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for leave in leaves %}
          <tr>
            <td>{{ leave.collector }}</td>
            <td>{{ leave.start_date }}</td>
            <td>{{ leave.end_date }}</td>
            <td>{{ leave.reason }}</td>
            <td>
              <!-- Status badge changes color depending on leave.status -->
              <span class="status-badge
                {% if leave.status == 'Approved' %}status-approved
                {% elif leave.status == 'Rejected' %}status-rejected
                {% else %}status-pending{% endif %}">
                {{ leave.status }}
              </span>
            </td>
            <td class="actions">
              <!-- Show Approve button only if not already approved -->
              {% if leave.status != 'Approved' %}
              <button class="action-btn" title="Approve" onclick="openModal('{{ leave.id }}','Approve')">
                <i class="bi bi-check-circle-fill"></i>
              </button>
              {% endif %}
              <!-- Show Reject button only if not already rejected -->
              {% if leave.status != 'Rejected' %}
              <button class="action-btn" title="Reject" onclick="openModal('{{ leave.id }}','Reject')">
                <i class="bi bi-x-circle-fill"></i>
              </button>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- ================================
       MODAL POPUP FOR APPROVE/REJECT
  ================================== -->
  <div id="actionModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <h2 id="modalTitle">Confirm Action</h2>
      <form method="POST" action="#">
        {% csrf_token %}
        <!-- Hidden inputs to pass leave ID and action type -->
        <input type="hidden" name="leave_id" id="modalLeaveId">
        <input type="hidden" name="action" id="modalAction">
        <!-- Optional note for remarks -->
        <div class="form-group">
          <label for="note">Note (Optional)</label>
          <textarea name="note" id="modalNote" rows="3" placeholder="Add any remarks..."></textarea>
        </div>
        <button type="submit" class="submit-btn">Submit</button>
      </form>
    </div>
  </div>

  <!-- ================================
       JAVASCRIPT FUNCTIONS
  ================================== -->
  <script>
    // Toggle sidebar open/close
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('collapsed');
    }

    // Modal variables
    const modal = document.getElementById('actionModal');
    const modalLeaveId = document.getElementById('modalLeaveId');
    const modalAction = document.getElementById('modalAction');
    const modalTitle = document.getElementById('modalTitle');
    const modalNote = document.getElementById('modalNote');

    // Open modal and set form values
    function openModal(leaveId, actionType) {
      modal.style.display = 'block';
      modalLeaveId.value = leaveId;
      modalAction.value = actionType;
      modalTitle.textContent = `${actionType} Leave Request`;
      modalNote.value = '';
    }

    // Close modal
    function closeModal() {
      modal.style.display = 'none';
    }

    // Close modal when clicking outside it
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = 'none';
      }
    }
    function toggleProfileMenu() {
    const menu = document.getElementById("profileDropdown");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
  }

  // Close menu if clicked outside
  document.addEventListener("click", function(e) {
    const profileMenu = document.querySelector(".profile-menu");
    if (!profileMenu.contains(e.target)) {
      document.getElementById("profileDropdown").style.display = "none";
    }
  });
  </script>
</body>
</html>
