<!-- miniproject/ecotrack/ecotracksys/templates/ecotracksys/admin_dashboard/admin_dashboard.html -->
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard | EcoTrack</title>

  <!-- =========================
       Font Awesome for Icons
       ========================= -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- =========================
       Internal CSS for Dashboard Styling
       ========================= -->
  <style>
    :root {
      --bg-image: url("{% static 'images/bgimg.jpg' %}");
      --primary: #04706e;
      --secondary: #2f9080;
      --highlight: #85fcde;
      --bg-overlay: rgba(109, 148, 135, 0.25);
      --shadow: rgba(3, 104, 77, 0.5);
      --text-dark: #0b3d2e;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg-image) no-repeat center center/cover;
      color: var(--text-dark);
    }

    .container {
      display: flex;
      min-height: 100vh;
      background: linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(103, 206, 168, 0.7));
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(103, 206, 168, 0.7));
      backdrop-filter: blur(12px);
      box-shadow: 2px 0 12px var(--shadow);
      transition: width 0.3s ease, padding 0.3s ease;
    }
    .sidebar.collapsed { width: 70px; padding: 0; }
    .sidebar h2 {
      text-align: center;
      padding: 20px 0;
      font-size: 1.6rem;
      margin: 0;
      color: var(--primary);
    }
    .sidebar.collapsed h2 { opacity: 0; }

    .sidebar ul { list-style: none; padding:0; margin:0; }
    .sidebar ul li a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 22px;
      color: var(--text-dark);
      text-decoration: none;
      border-radius: 8px;
      transition: background 0.3s ease;
    }
    .sidebar ul li a:hover { background: var(--secondary); color:#fff; }
    .sidebar ul li a.active { background: var(--primary); color:#fff; font-weight:bold; }
    .sidebar.collapsed ul li span { display: none; }

    .toggle-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: none;
      border: none;
      font-size: 22px;
      color: var(--text-dark);
      cursor: pointer;
    }

    /* Main content */
    .main {
      flex: 1;
      padding: 24px;
      backdrop-filter: blur(6px);
      position: relative;
    }

    .dashboard-header {
      font-size: 26px;
      font-weight: bold;
      margin-bottom: 25px;
      color: var(--primary);
    }

    /* Cards */
    .card-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px,1fr));
      gap: 20px;
    }
    .card {
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(10px);
      padding: 24px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 4px 20px var(--shadow);
      transition: transform 0.2s;
      color: #0b3d2e;
    }
    .card:hover { transform: translateY(-5px); }
    .card i { font-size:26px; color: var(--highlight); margin-bottom:10px; }
    .card h3 { font-size:18px; margin-bottom:8px; color: var(--primary); }
    .card p {
      font-size:22px;
      font-weight:bold;
      background: var(--primary);
      display:inline-block;
      padding:6px 16px;
      border-radius:12px;
      color:#fff;
      box-shadow:0 2px 10px var(--shadow);
    }

    /* Extra section */
    .extra-section {
      margin-top:40px;
      display:flex;
      flex-wrap:wrap;
      gap:20px;
    }
    .profile-box, .bar-chart-box {
      flex: 1 1 300px;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(10px);
      padding:20px;
      border-radius:16px;
      box-shadow:0 4px 20px var(--shadow);
      color:#0b3d2e;
    }
    .profile-box h3, .bar-chart-box h3 { margin-bottom:16px; font-size:20px; color: var(--primary); }
    .bar { height:18px; margin:8px 0; background-color: rgba(0,0,0,0.05); border-radius:10px; }
    .bar span { display:block; height:100%; border-radius:10px; background: var(--primary); }
    .bar-label { font-size:14px; margin-bottom:4px; }

    /* Profile menu */
    .profile-menu {
      position: absolute;
      top: 16px;
      right: 30px;
    }
    .profile-img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--primary);
      cursor: pointer;
      transition: transform 0.2s;
      display: block;
    }
    .profile-img:hover { transform: scale(1.05); }
    .profile-dropdown {
      display: none;
      position: absolute;
      right: 0;
      top: 55px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px var(--shadow);
      overflow: hidden;
      z-index: 1000;
      min-width: 150px;
    }
    .profile-dropdown a {
      display: block;
      padding: 10px 14px;
      text-decoration: none;
      color: var(--text-dark);
      font-size: 14px;
      transition: background 0.2s;
    }
    .profile-dropdown a:hover { background: var(--secondary); color: #fff; }

    @media screen and (max-width:768px){
      .sidebar { position:fixed; height:100%; z-index:1000; }
      .main { margin-left:70px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <h2 id="brandText">EcoTrack</h2>
      <button class="toggle-btn" onclick="toggleSidebar()" aria-label="Toggle sidebar">â˜°</button>

      <ul>
        <li><a href="{% url 'ecotracksys:admin_dashboard' %}" class="active"><i class="fas fa-home"></i> <span>Dashboard</span></a></li>
        <li><a href="{% url 'ecotracksys:pickup_management' %}"><i class="fas fa-trash"></i> <span>Pickup Management</span></a></li>
        <li><a href="{% url 'ecotracksys:zone_management' %}"><i class="fas fa-map-marker-alt"></i> <span>Zone Management</span></a></li>
        <li><a href="{% url 'ecotracksys:leave_request_management' %}"><i class="fas fa-calendar-alt"></i> <span>Leave Requests</span></a></li>
        <li><a href="{% url 'ecotracksys:complaint_management' %}"><i class="fas fa-bullhorn"></i> <span>Complaints</span></a></li>
        <li><a href="{% url 'ecotracksys:user_management' %}"><i class="fas fa-users"></i> <span>User Management</span></a></li>
        <li><a href="{% url 'ecotracksys:collector_management' %}"><i class="fas fa-user-cog"></i> <span>Collector Management</span></a></li>
        <li><a href="{% url 'ecotracksys:analytics' %}"><i class="fas fa-chart-line"></i> <span>Analytics</span></a></li>
        <li><a href="{% url 'ecotracksys:admin_profile' %}"><i class="fas fa-user-shield"></i> <span>Admin Profile</span></a></li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="main">
      <!-- Profile Image Dropdown -->
      <div class="profile-menu">
        {% if user.is_authenticated %}
          {% if request.user.profile_image %}
            <img src="{{ request.user.profile_image.url }}" alt="Profile Image" class="profile-img" onclick="toggleProfileMenu()">
          {% else %}
            <img src="{% static 'default_profile.png' %}" alt="Profile Image" class="profile-img" onclick="toggleProfileMenu()">
          {% endif %}
        {% endif %}

        <!-- Dropdown Menu -->
        <div class="profile-dropdown" id="profileDropdown">
          <a href="{% url 'ecotracksys:admin_profile' %}">ðŸ‘¤ View Profile</a>
          <a href="{% url 'logout' %}">ðŸšª Logout</a>
        </div>
      </div>

      <div class="dashboard-header">Admin Dashboard Overview</div>

      <!-- Info Cards -->
      <div class="card-container">
        <div class="card">
          <i class="fas fa-truck"></i>
          <h3>Total Pickup Requests</h3>
          <p>{{ total_pickup_requests }}</p>
          <span style="display:block; margin-top:6px;">Completed: {{ completed_pickups }} &nbsp;&nbsp; ðŸ•’ Active: {{ active_pickups }}</span>
        </div>
        <div class="card"><i class="fas fa-plus-circle"></i><h3>New Pickup Requests</h3><p>{{ new_pickup_requests }}</p></div>
        <div class="card"><i class="fas fa-times-circle"></i><h3>Missed Pickups</h3><p>{{ missed_pickups }}</p></div>
        <div class="card"><i class="fas fa-comment-alt"></i><h3>New Complaints</h3><p>{{ new_complaints }}</p></div>
        <div class="card"><i class="fas fa-calendar-minus"></i><h3>New Leave Requests</h3><p>{{ new_leave_requests }}</p></div>
        <div class="card"><i class="fas fa-user-plus"></i><h3>New Collectors</h3><p>{{ new_collectors }}</p></div>
        <div class="card"><i class="fas fa-exclamation-triangle"></i><h3>System Alerts</h3><p>{{ system_alerts }}</p></div>
        <div class="card">
          <i class="fas fa-user"></i>
          <h3>Active Collectors</h3>
          <p>{{ active_collectors }}</p>
          <strong style="color:#ff5252; display:block; margin-top:6px;">{{ collectors_on_leave_today }} on leave today</strong>
        </div>
      </div>

      <!-- Extra Section -->
      <div class="extra-section">
        <div class="profile-box">
          <h3><i class="fas fa-user-circle"></i> Quick Profile Access</h3>
          <p>Logged in as <strong>Admin (eco_admin01)</strong></p>
          <p><a href="#">Edit Profile</a> | <a href="#">Change Password</a></p>
        </div>
        <div class="bar-chart-box">
          <h3><i class="fas fa-chart-bar"></i> Weekly Pickup Overview</h3>
          <canvas id="weeklyChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById("sidebar");
      sidebar.classList.toggle("collapsed");
    }

    function toggleProfileMenu() {
      const menu = document.getElementById("profileDropdown");
      menu.style.display = menu.style.display === "block" ? "none" : "block";
    }

    // Close menu if clicked outside
    document.addEventListener("click", function(e) {
      const profileMenu = document.querySelector(".profile-menu");
      if (!profileMenu.contains(e.target)) {
        document.getElementById("profileDropdown").style.display = "none";
      }
    });
  </script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const ctx = document.getElementById('weeklyChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [{
          label: 'Pickups Completed',
          data: [12, 19, 7, 14, 10, 15, 9],
          backgroundColor: '#66bb6a',
          borderRadius: 8
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });
  </script>
</body>
</html>
